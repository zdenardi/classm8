generator client {
  provider   = "prisma-client"
  output     = "./generated"
  engineType = "client"
  runtime    = "deno"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        Int    @id @default(autoincrement())
  email     String @unique
  firstName String
  lastName  String
  role      Role   @default(STUDENT)

  // Relations
  enrollments       UsersInCourses[]
  scenesPerformed   UsersAndScenes[]
  coursesInstructed Course[]

  createdAt DateTime @default(now()) @db.Timestamptz(6)
  updatedAt DateTime @updatedAt @db.Timestamptz(6)
}

model Course {
  id           Int    @id @default(autoincrement())
  title        String
  studentLimit Int?
  instructorId Int

  // Relations
  instructor User             @relation(fields: [instructorId], references: [id])
  students   UsersInCourses[]
  classes    Class[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Class {
  id            Int      @id @default(autoincrement())
  courseId      Int
  location      String
  notes         String?
  streamingLink String
  startDate     DateTime
  endDate       DateTime

  // Relations
  course Course            @relation(fields: [courseId], references: [id], onDelete: Cascade)
  scenes ScenesInClasses[]
}

model Scene {
  id       Int        @id @default(autoincrement())
  duration Int // In Minutes
  title    String
  type     SceneTypes
  notes    String?

  // Relations
  performers UsersAndScenes[]
  classes    ScenesInClasses[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model UsersInCourses {
  userId   Int
  courseId Int
  hasPaid  Boolean @default(false)

  // Relations
  user   User   @relation(fields: [userId], references: [id])
  course Course @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@id([userId, courseId])
}

model UsersAndScenes {
  userId  Int
  sceneId Int

  // Relations
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)
  scene Scene @relation(fields: [sceneId], references: [id], onDelete: Cascade)

  @@id([userId, sceneId])
}

model ScenesInClasses {
  classId  Int
  sceneId  Int
  approved Boolean @default(false)
  order    Int     @unique

  // Relations
  class Class @relation(fields: [classId], references: [id], onDelete: Cascade)
  scene Scene @relation(fields: [sceneId], references: [id], onDelete: Cascade)

  @@id([classId, sceneId])
}

enum Role {
  ADMIN
  STUDENT
  MODERATOR
  INSTRUCTOR
}

enum SceneTypes {
  PLAY
  FILM
  MONOLOGUE
  SONG
  TELEVISION
  OTHER
}
